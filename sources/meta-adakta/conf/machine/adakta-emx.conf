#@TYPE: Machine
#@NAME: ADAKTA BSP for IMX6 EMX module
#@SOC: i.MX6 Q/DL
#@DESCRIPTION: Machine configuration for Adakta EMX module
#@MAINTAINER: Ilya Gorchakov <ilya.gorchakov@adakta.ru>
#
#
# By default, this machine will build for the standard Quad-Core, 1GB
# option.
#
# To build U-Boot for other CPU or memory combinations, you can set
# the UBOOT_MACHINE variable in your local.conf according to the
# following table:
#
# Processor           Memory    Configuration
# --------------      ------    --------------------
# i.MX6Quad/Dual        1GB     adakta_qd1g_config
# i.MX6Quad/Dual        2GB     adakta_qd2g_config
# i.MX6Quad/Dual        4GB     adakta_qd4g_config
# i.MX6Dual-Lite        1GB     adakta_dl1g_config
# i.MX6Dual-Lite        2GB     adakta_dl2g_config
# i.MX6Solo           512MB     adakta_s0g_config
# i.MX6Solo             1GB     adakta_s1g_config
#
#
#

MACHINEOVERRIDES =. "mx6:mx6dl:mx6q:"

include conf/machine/include/imx-base.inc
include conf/machine/include/tune-cortexa9.inc


KERNEL_DEVICETREE_emxstand = "imx6qd-emx_stand.dtb imx6dls-emx_stand.dtb"
KERNEL_DEVICETREE_emx = "imx6qd-emx.dtb imx6dls-emx.dtb"

KERNEL_DEVICETREE = " \
${@bb.utils.contains_any("KERNEL_DEFCONFIG_TYPE", "emx", "${KERNEL_DEVICETREE_emx}" , "", d)} \
${@bb.utils.contains_any("KERNEL_DEFCONFIG_TYPE", "emxstand", "${KERNEL_DEVICETREE_emxstand}" , "", d)} \
"

KERNEL_IMAGETYPE = "zImage"

PREFERRED_PROVIDER_u-boot = "u-boot-adakta"
PREFERRED_PROVIDER_virtual/kernel ??= "linux-emx"

PREFERRED_PROVIDER_virtual/kernel_use-mainline-bsp ??= "linux-fslc"

# Use SPI NOR U-Boot by default
IMAGE_BOOTLOADER ?= ""

# Ensure boot scripts will be available at rootfs time
do_rootfs[depends] += "u-boot-script-adakta:do_deploy"

# Boot scripts to install
BOOT_SCRIPTS = "6x_bootscript-${MACHINE}:6x_bootscript"

IMAGE_BOOT_FILES = " \
    6x_bootscript-${MACHINE};6x_bootscript \
    ${KERNEL_IMAGETYPE} \
    ${KERNEL_IMAGETYPE}-${@bb.utils.contains_any("KERNEL_DEFCONFIG_TYPE", "emx", "imx6qd-emx.dtb;imx6dls-emx.dtb" , "", d)} \
    ${KERNEL_IMAGETYPE}-${@bb.utils.contains_any("KERNEL_DEFCONFIG_TYPE", "emxstand", "imx6qd-emx_stand.dtb;imx6dls-emx_stand.dtb" , "", d)} \
"

UBOOT_MACHINE ?= "adakta-emx6-qd2g_config"

SERIAL_CONSOLE = "115200 ttymxc1"

MACHINE_ESSENTIAL_EXTRA_RDEPENDS += " \
    kernel-image \
    kernel-devicetree \
"

MACHINE_FEATURES += " pci"
